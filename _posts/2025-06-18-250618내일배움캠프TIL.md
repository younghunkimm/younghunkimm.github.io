---
title: ë‚´ì¼ë°°ì›€ìº í”„ ì‚¬ì „ìº í”„ ì˜¨ë¼ì¸ê°•ì˜ SQL 5ì£¼ì°¨
categories: [ë‚´ì¼ë°°ì›€ìº í”„]
tags: [ë‚´ì¼ë°°ì›€ìº í”„, ì‚¬ì „ìº í”„, TIL]
date: '2025-06-18 18:19:00 +0900'
---

## ğŸš€ ê³µë¶€í•œ ë‚´ìš©

### ê°’ì˜ ì œì™¸

```sql
SELECT restaurant_name,
       AVG(rating) AS avg_rating,
       AVG(IF(rating <> 'Not given', rating, null)) AS avg_rating2
FROM food_orders
GROUP BY 1;
```

> mysqlì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê°’ì¼ ë•Œ í•´ë‹¹ ê°’ì„ `0`ìœ¼ë¡œ ê°„ì£¼
{: .prompt-tip}

> ëª…í™•í•˜ê²Œ ì—°ì‚°ì„ ì§€ì •í•´ì£¼ê¸° ìœ„í•´ `null` ë¬¸ë²•ì„ ì‚¬ìš©
{: .prompt-tip}

### ê°’ì˜ ë³€ê²½

```sql
SELECT a.order_id,
       a.customer_id,
       a.restaurant_name,
       a.price,
       b.name,
       b.age,
       COALESCE(b.age, 20) AS "null ì œê±°",
       b.gender
FROM food_orders a LEFT JOIN customers b ON a.customer_id=b.customer_id
WHERE b.age IS NULL;
```

> `COALESCE(a, b)` : ë‘ ê°œì˜ ì¸ìë¥¼ ë°›ì•„ aì˜ ê°’ì´ NULL ì´ë¼ë©´ bë¡œ ëŒ€ì²´, bì˜ ê°’ì´ NULL ì´ë¼ë©´ aë¡œ ëŒ€ì²´
{: .prompt-tip}

### Pivot Table

- ìŒì‹ì ë³„ ì‹œê°„ë³„ ì£¼ë¬¸ê±´ìˆ˜ (15 ~ 20ì‹œ ì‚¬ì´, 20ì‹œ ì£¼ë¬¸ê±´ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
  ```sql
  SELECT restaurant_name,
         MAX(IF(hh = '15', cnt_order, 0)) AS "15",
         MAX(IF(hh = '16', cnt_order, 0)) AS "16",
         MAX(IF(hh = '17', cnt_order, 0)) AS "17",
         MAX(IF(hh = '18', cnt_order, 0)) AS "18",
         MAX(IF(hh = '19', cnt_order, 0)) AS "19",
         MAX(IF(hh = '20', cnt_order, 0)) AS "20"
  FROM (
    SELECT f.restaurant_name,
           SUBSTR(p.time, 1, 2) AS hh,
           COUNT(*) AS cnt_order
    FROM food_orders AS f INNER JOIN payments AS p ON f.order_id = p.order_id
    WHERE SUBSTR(p.time, 1, 2) BETWEEN 15 AND 20
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ORDER BY 7 DESC;
  ```

  ![Image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fde7kwk%2FbtsOQBdjqGy%2FAAAAAAAAAAAAAAAAAAAAACDHP89DNW64zmyl-h4tpxSxe1_nvHkPV8PnAim_ZKtv%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1751295599%26allow_ip%3D%26allow_referer%3D%26signature%3D30Pj3je4xOdbK4kIW0xF7csmdAU%253D)

- ì„±ë³„, ì—°ë ¹ë³„ ì£¼ë¬¸ê±´ìˆ˜ (10 ~ 59ì„¸ ì‚¬ì´, ì—°ë ¹ ìˆœìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ)
  ```sql
  SELECT age,
         MAX(IF(gender = 'male', cnt_order, 0)) AS "male",
         MAX(IF(gender = 'female', cnt_order, 0)) AS "female"
  FROM (
    SELECT gender,
           CASE WHEN age BETWEEN 10 AND 19 THEN 10
                WHEN age BETWEEN 20 AND 29 THEN 20
                WHEN age BETWEEN 30 AND 39 THEN 30
                WHEN age BETWEEN 40 AND 49 THEN 40
                WHEN age BETWEEN 50 AND 59 THEN 50
           END AS "age",
           COUNT(*) AS "cnt_order"
    FROM food_orders f INNER JOIN customers c ON f.customer_id = c.customer_id
    WHERE age BETWEEN 10 AND 59
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ORDER BY 1 DESC;
  ```

  ![Image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FNyBgt%2FbtsOQcLXdrm%2FAAAAAAAAAAAAAAAAAAAAAC_lh47HLQ6FstlArkkQKIsC4Ltjy_cHweYU2jnMDB82%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1751295599%26allow_ip%3D%26allow_referer%3D%26signature%3DJZG8WrGwKZiqIjmR9HOI8xMH90g%253D)

- ìŒì‹ íƒ€ì…ë³„, ì—°ë ¹ë³„ ì£¼ë¬¸ê±´ìˆ˜ (10 ~ 59ì„¸ ì‚¬ì´)
  ```sql
  SELECT cuisine_type,
         MAX(IF(age = '10', cnt_order, 0)) AS "10ëŒ€",
         MAX(IF(age = '20', cnt_order, 0)) AS "20ëŒ€",
         MAX(IF(age = '30', cnt_order, 0)) AS "30ëŒ€",
         MAX(IF(age = '40', cnt_order, 0)) AS "40ëŒ€",
         MAX(IF(age = '50', cnt_order, 0)) AS "50ëŒ€"
  FROM (
    SELECT cuisine_type,
           CASE WHEN age BETWEEN 10 AND 19 THEN 10
                WHEN age BETWEEN 20 AND 29 THEN 20
                WHEN age BETWEEN 30 AND 39 THEN 30
                WHEN age BETWEEN 40 AND 49 THEN 40
                WHEN age BETWEEN 50 AND 59 THEN 50
           END AS "age",
           COUNT(*) AS "cnt_order"
    FROM food_orders f INNER JOIN customers c ON f.customer_id = c.customer_id
    WHERE age BETWEEN 10 AND 59
    GROUP BY 1, 2
  ) a
  GROUP BY 1
  ```

  ![Image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FsuRYs%2FbtsOSiwy73I%2FAAAAAAAAAAAAAAAAAAAAANFEDcjHh0LU0xamoqlZ9jIzROw-Cy2OS4YHNKX4eo1T%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1751295599%26allow_ip%3D%26allow_referer%3D%26signature%3DFnbuYKlpqVQze2lzGlWGLewPnDM%253D)

### RANK

- ìŒì‹ íƒ€ì…ë³„ë¡œ ì£¼ë¬¸ ê±´ìˆ˜ê°€ ê°€ì¥ ë§ì€ ìƒì  3ê°œì”© ì¡°íšŒí•˜ê¸°
  ```sql
  SELECT cuisine_type,
         restaurant_name,
         cnt_order,
         ranking
  FROM (
    SELECT cuisine_type,
           restaurant_name,
           cnt_order,
           RANK() OVER (PARTITION BY cuisine_type ORDER BY cnt_order DESC) AS "ranking"
    FROM (
      SELECT cuisine_type,
             restaurant_name,
             count(*) AS cnt_order
      FROM food_orders
      GROUP BY 1, 2
    ) a
  ) b
  WHERE ranking <= 3;
  ```

  ![Image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FdFdrmt%2FbtsOQgmmd8V%2FAAAAAAAAAAAAAAAAAAAAAIQtJyiwwAPv8s5MyN7KhkSpcp2vxBshnQ9rBpat3Xk-%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1751295599%26allow_ip%3D%26allow_referer%3D%26signature%3DZHKuDS4anbJ8BDuaeQN%252BCzOC06c%253D)

### SUM

- ê° ìŒì‹ì ì˜ ì£¼ë¬¸ê±´ì´ í•´ë‹¹ ìŒì‹ íƒ€ì…ì—ì„œ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨ì„ êµ¬í•˜ê³ , ì£¼ë¬¸ê±´ì´ ë‚®ì€ ìˆœìœ¼ë¡œ ì •ë ¬í–ˆì„ ë•Œ ëˆ„ì  í•© êµ¬í•˜ê¸°
  ```sql
  SELECT cuisine_type,
         restaurant_name,
         cnt_order,
         SUM(cnt_order) OVER (PARTITION BY cuisine_type) AS "sum_cuisine",
         SUM(cnt_order) OVER (PARTITION BY cuisine_type ORDER BY cnt_order) AS "cum_cuisine"
  FROM (
    SELECT cuisine_type,
           restaurant_name,
           count(*) AS cnt_order
    FROM food_orders
    GROUP BY 1, 2
  ) a
  ORDER BY cuisine_type, cnt_order;
  ```

  ![Image](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FVWnF2%2FbtsOQHq9iH4%2FAAAAAAAAAAAAAAAAAAAAABZvUWxLZZ3bAd8q0RkARX-7GZoJrDmNGS6SAuK6JERs%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1751295599%26allow_ip%3D%26allow_referer%3D%26signature%3Di5WEXK21Jo5ZFVF9pQEgnLuU7QE%253D)

### ë‚ ì§œ ë°ì´í„°

- í¬ë§·
  ```sql
  SELECT DATE(date) AS "date_type",
       DATE_FORMAT(DATE(date), '%Y') AS "ë…„",
       DATE_FORMAT(DATE(date), '%m') AS "ì›”",
       DATE_FORMAT(DATE(date), '%d') AS "ì¼",
       DATE_FORMAT(DATE(date), '%w') AS "ìš”ì¼"
  FROM payments;
  ```

- ë‚ ì§œë¡œ GROUP BY
  ```sql
  SELECT DATE_FORMAT(DATE(date), '%Y') AS "ë…„",
         DATE_FORMAT(DATE(date), '%m') AS "ì›”",
         DATE_FORMAT(DATE(date), '%Y%m') AS "ë…„ì›”",
         COUNT(*) AS "ì£¼ë¬¸ê±´ìˆ˜"
  FROM food_orders f INNER JOIN payments p ON f.order_id = p.order_id
  WHERE DATE_FORMAT(DATE(date), '%m') = '03'
  GROUP BY 1, 2, 3
  ORDER BY 1;
  ```

## ğŸš€ íšŒê³ 

SQLì„ í™œìš©í•˜ì—¬ Pivot Tableì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ì‹ ê¸°í–ˆê³ ,   
5ì£¼ì°¨ ê°•ì˜ì—ëŠ” ì¡°ê¸ˆ ì–´ë µì§€ë§Œ ì¤‘ìš”í•œ ë¬¸ë²•ë“¤ì´ ë§ì´ ìˆì—ˆë˜ ê±° ê°™ë‹¤.